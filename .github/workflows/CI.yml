name: DotNet Main

on:
  push:
    branches: [main]

  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: microsoft/setup-msbuild@v1.3
        with:
          msbuild-architecture: x64
      - name: Setup .NET Core SDK
        uses: actions/setup-dotnet@v3.0.3

      - name: Restore dependencies
        run: nuget restore src\Wpf.Ui.sln

      - name: Build the solution
        run: msbuild src\Wpf.Ui.sln -p:Configuration=Release -p:Platform="Any CPU" -p:GITHUB_ACTIONS=True -m -graph -isolate

      - name: Pack
        run: dotnet pack --configuration Release --output artifacts
        
      - name: Push
        run: dotnet nuget push "*" -s ${{ github.event.inputs.packageSource }} -k ${{secrets.API_BAGET}}
        working-directory: artifacts

      - name: Publish the package to NuGet.org
        run: dotnet nuget push "*" -s ${{ vars.NUGET_URL }} -k ${{ secrets.API_BAGET }
